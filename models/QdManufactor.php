<?php

class QdManufactor extends QdProductCat
{
    public static $TYPE2_MANUFACTOR_DIENTHOAI = 'DIENTHOAI';
    public static $TYPE2_MANUFACTOR_SUUTAP = 'SUUTAP';
    public static $TYPE2_MANUFACTOR_DODUNG = 'DODUNG';
    public static $TYPE2_MANUFACTOR_MTB = 'MTB';
    public static $TYPE2_MANUFACTOR_LAPTOP = 'LAPTOP';
    public static $TYPE2_MANUFACTOR_PHUKIEN = 'PHUKIEN';
    public static $TYPE2_MANUFACTOR_XEDAP = 'XEDAP';
    public static $TYPE2_MANUFACTOR_XEMAY = 'XEMAY';
    public static $TYPE2_MANUFACTOR_OTO = 'OTO';
    public static $TYPE2_MANUFACTOR_NUOCHOA = 'NUOCHOA';
    public static $TYPE2_MANUFACTOR_THOITRANG = 'THOITRANG';
    public static $TYPE2_MANUFACTOR_DONGHO_MK = 'DONGHO_MK';
    public static $TYPE2_MANUFACTOR_OTHER = 'OTHER';

    public function __construct(array $attributes = array(), $guard_attributes = true, $instantiating_via_find = false, $new_record = true)
    {
        parent::__construct($attributes, $guard_attributes, $instantiating_via_find, $new_record);
        $this->SETFILTERDEFAULT(array(
            array('field' => 'type', 'value' => static::$TYPE_MANUFACTOR, 'operator' => static::$OP_EQUAL)
        ));
    }

    public static function getInitObj()
    {
        $obj = new QdManufactor();
        $obj->type = static::$TYPE_MANUFACTOR;
        $obj->active = true;
        return $obj;
    }

    public static function getFieldsConfig()
    {
        $obj = parent::getFieldsConfig(); // TODO: Change the autogenerated stub
        $obj['name']['Caption'] = array('en-US' => 'Name', 'vi-VN' => 'Tên hãng');
        //change parent_id filter
        $obj['parent_id']['TableRelation'] = array(
            'Table' => 'QdManufactor',
            'Field' => 'id',
            'TableFilter' => array(
                array(
                    'Condition' => array(
                        'Field' => '',
                        'Type' => 'CONST',//'FIELD'
                        'Value' => ''
                    ),
                    'Field' => 'type',
                    'Type' => 'FIELD',
                    'Value' => static::$TYPE_MANUFACTOR
                )
            )
        );
        $obj['type']['Options'] = array(
            static::$TYPE_MANUFACTOR => array(
                'Caption' => array('en-US' => 'Manufactor', 'vi-VN' => 'Hãng SX'),
            )
        );
        $obj['_product_count']['FieldClass_FlowField']['TableFilter']['product_cat_id']['Field'] = 'manufacturer_id';
        $obj['__sys_lines_url']['TableRelation'] = array(
            'Table' => 'QdProduct',
            'Field' => 'id',
            'TableFilter' => array(
                array(
                    'Condition' => array(
                        'Field' => '',
                        'Type' => 'CONST',//'FIELD'
                        'Value' => ''
                    ),
                    'Field' => 'manufacturer_id',
                    'Type' => 'FIELD',
                    'Value' => 'id'
                )
            )
        );
        unset($obj['_permalink_search_page_struct_lv1']);
        unset($obj['_permalink_search_page_struct_lv2']);

        return $obj;
    }

    public function getPermalink()
    {
        $query = get_permalink(Qdmvc_Helper::getPageIdByTemplate('page-templates/product-search.php'));
        $query = add_query_arg(array('manufactor-id' => $this->id), $query);
        return $query;
        /*
        $query =  get_site_url();
        $query .= sprintf('/loaisp/%s/%s', $this->id, Qdmvc_Helper::sanitize_title_with_dashes($this->name));
        return $query;*/
    }

    public function GETRTABLES()
    {
        return array(
            'QdProduct' =>array(
                'manufacturer_id'
            )
        );
    }

    protected function TABLECAPTION()
    {
        return array(
            'vi-VN' => 'Hãng SX',
            'en-US' => 'Manufacturer'
        );
    }
    


}